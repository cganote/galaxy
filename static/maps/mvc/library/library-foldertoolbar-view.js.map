{"version":3,"sources":["mvc/library/library-foldertoolbar-view.js"],"names":["FolderToolbarView","Backbone","View","extend","el","events","defaults","can_add_library_item","contains_file_or_folder","chain_call_control","total_number","failed_number","disabled_jstree_element","modal","jstree","histories","select_genome","select_extension","list_extensions","auto","id","text","description","list_genomes","initialize","options","_","fetchExtAndGenomes","render","toolbar_template","templateToolBar","template_defaults","is_admin","is_anonym","multiple_add_dataset_options","Galaxy","user","isAdmin","isAnonymous","config","user_library_import_dir","allow_library_path_paste","library_import_dir","$el","html","renderPaginator","paginator_template","templatePaginator","$","find","show_page","parseInt","page_count","total_items_count","items_shown","folder_page_size","libraries","preferences","get","configureElements","show","hide","tooltip","trigger","createFolderFromModal","event","preventDefault","stopPropagation","template","templateNewFolderInModal","closing_events","title","body","buttons","Create","createNewFolderEvent","Close","folderDetails","serializeNewFolder","validateNewFolder","folder","mod_library_model","FolderAsModel","url_items","history","fragment","split","current_folder_id","indexOf","length","url","urlRoot","save","success","mod_toastr","set","type","folderListView","collection","add","error","model","response","responseJSON","err_msg","name","val","importToHistoryModal","e","$checkedValues","findCheckedRows","templateImportIntoHistoryModal","info","promise","fetchUserHistories","done","models","Import","importAllIntoHistory","fail","GalaxyHistories","fetch","disableButton","new_history_name","createNewHistory","processImportToHistory","new_history","xhr","status","always","enableButton","history_id","history_name","post","root","checked_items","findCheckedItems","items_to_import","i","dataset_ids","library_dataset_id","historyItem","HistoryItem","content","source","push","folder_ids","library_folder_id","initChainCallControl","action","jQuery","getJSON","chainCallImportingIntoHistory","updateProgress","progress","progressStep","width","Math","round","txt_representation","download","format","data","ld_ids","processDownload","method","param","inputs","each","pair","appendTo","submit","remove","addFilesFromHistoryModal","template_modal","templateAddFilesFromHistory","Add","addAllDatasetsFromHistory","closing_callback","library_router","navigate","fetchAndDisplayHistoryContents","change","target","value","importFilesFromPathModal","templateImportPathModal","importFromPathsClicked","renderSelectBoxes","mod_utils","key","datatypes","extension","description_url","sort","a","b","unshift","cache","genomes","mod_select","css","container","importFilesFromGalaxyFolderModal","templateBrowserModal","importFromJstreePath","bind","renderJstree","Jstree","core","plugins","types","icon","file","checkbox","three_state","err_code","warning","preserve_dirs","is","link_data","space_to_tab","to_posix_lines","tag_using_filenames","file_type","dbkey","paths","valid_paths","trimmed","trim","chainCallImportingFolders","templateAddingDatasetsProgressBar","folder_name","templateDeletingItemsProgressBar","templateImportIntoHistoryProgressBar","emit","that","all_nodes","get_selected","selected_nodes","filter","node","state","disabled","selection_type","li_attr","full_path","undefined","full_source","chainCallImportingUserdirFiles","history_contents","HistoryContents","history_contents_template","templateHistoryContents","contents","reverse","prop","checked_hdas","history_item_ids","history_item_types","items_to_add","hid","closest","item_type","history_item_id","folder_item","Item","from_hdca_id","from_hda_id","chainCallAddingHdas","history_item_set","popped_item","pop","onclick","window","location","when","hdas_set","added_hdas","Folder","chainCallDeletingItems","items_to_delete","deleted_items","item_to_delete","destroy","include_deleted","updated_item","item","model_class","checkIncludeDeleted","checked","fetchFolder","deleteSelectedItems","row_id","substring","items_total","dataset","showLocInfo","library","libraryListView","parent_library_id","showLocInfoModal","Library","templateLocInfoInModal","showImportModal","back","showPageSizePrompt","prompt","showCollectionSelect","templateCollectionSelectModal","selected_datasets","Continue","showColectionBuilder","prepareCollectionTypeSelect","prepareHistoryTypeSelect","collectionType","select_collection_type","onchange","updateCollectionType","history_options","select_collection_history","collection_elements","elements_source","collection_item","folder_container","deleted","Collection","where","toJSON","collectionImport","selected_history_id","selected_history_name","modal_title","creator_class","creationFn","LIST_CREATOR","ListCollectionCreator","elements","hideSourceItems","map","element","src","createHDCA","collectionCreatorModal","defaultHideSourceItems","PAIR_CREATOR","PairCollectionCreator","PAIRED_CREATOR","pairedCollectionCreatorModal","historyId","ruleBasedCollectionCreatorModal","elementIdentifiers","hdca","HDCA_MODEL","HistoryDatasetCollection","history_content_type","collection_type","hide_source_items","element_identifiers","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-foldertoolbar-view.js","sourcesContent":["import _l from \"utils/localization\";\nimport mod_utils from \"utils/utils\";\nimport mod_toastr from \"libs/toastr\";\nimport mod_library_model from \"mvc/library/library-model\";\nimport mod_select from \"mvc/ui/ui-select\";\nimport LIST_CREATOR from \"mvc/collection/list-collection-creator\";\nimport PAIR_CREATOR from \"mvc/collection/pair-collection-creator\";\nimport PAIRED_CREATOR from \"mvc/collection/list-of-pairs-collection-creator\";\nimport HDCA_MODEL from \"mvc/history/hdca-model\";\nimport \"libs/jquery/jstree\";\n\nvar FolderToolbarView = Backbone.View.extend({\n    el: \"#center\",\n\n    events: {\n        \"click .toolbtn-create-folder\": \"createFolderFromModal\",\n        \"click .toolbtn-bulk-import\": \"importToHistoryModal\",\n        \"click .include-deleted-datasets-chk\": \"checkIncludeDeleted\",\n        \"click .toolbtn-bulk-delete\": \"deleteSelectedItems\",\n        \"click .toolbtn-show-locinfo\": \"showLocInfo\",\n        \"click .page-size-prompt\": \"showPageSizePrompt\",\n        \"click .toolbtn-collection-import\": \"showCollectionSelect\"\n    },\n\n    defaults: {\n        can_add_library_item: false,\n        contains_file_or_folder: false,\n        chain_call_control: {\n            total_number: 0,\n            failed_number: 0\n        },\n        disabled_jstree_element: \"folders\"\n    },\n\n    modal: null,\n\n    // directory browsing object\n    jstree: null,\n\n    // user's histories\n    histories: null,\n\n    // genome select\n    select_genome: null,\n\n    // extension select\n    select_extension: null,\n\n    // extension types\n    list_extensions: [],\n\n    // datatype placeholder for extension auto-detection\n    auto: {\n        id: \"auto\",\n        text: \"Auto-detect\",\n        description:\n            \"This system will try to detect the file type automatically.\" +\n            \" If your file is not detected properly as one of the known formats,\" +\n            \" it most likely means that it has some format problems (e.g., different\" +\n            \" number of columns on different rows). You can still coerce the system\" +\n            \" to set your data to the format you think it should be.\" +\n            \" You can also upload compressed files, which will automatically be decompressed.\"\n    },\n\n    // genomes\n    list_genomes: [],\n\n    initialize: function(options) {\n        this.options = _.defaults(options || {}, this.defaults);\n        this.fetchExtAndGenomes();\n        this.render();\n    },\n\n    render: function(options) {\n        this.options = _.extend(this.options, options);\n        var toolbar_template = this.templateToolBar();\n        var template_defaults = {\n            id: this.options.id,\n            is_admin: false,\n            is_anonym: true,\n            multiple_add_dataset_options: false\n        };\n        if (Galaxy.user) {\n            template_defaults.is_admin = Galaxy.user.isAdmin();\n            template_defaults.is_anonym = Galaxy.user.isAnonymous();\n            if (\n                Galaxy.config.user_library_import_dir !== null ||\n                Galaxy.config.allow_library_path_paste !== false ||\n                Galaxy.config.library_import_dir !== null\n            ) {\n                template_defaults.multiple_add_dataset_options = true;\n            }\n        }\n        this.$el.html(toolbar_template(template_defaults));\n    },\n\n    /**\n     * Called from FolderListView when needed.\n     * @param  {object} options common options\n     */\n    renderPaginator: function(options) {\n        this.options = _.extend(this.options, options);\n        var paginator_template = this.templatePaginator();\n        $(\"body\")\n            .find(\".folder-paginator\")\n            .html(\n                paginator_template({\n                    id: this.options.id,\n                    show_page: parseInt(this.options.show_page),\n                    page_count: parseInt(this.options.page_count),\n                    total_items_count: this.options.total_items_count,\n                    items_shown: this.options.items_shown,\n                    folder_page_size: Galaxy.libraries.preferences.get(\"folder_page_size\")\n                })\n            );\n    },\n\n    configureElements: function(options) {\n        this.options = _.extend(this.options, options);\n\n        if (this.options.can_add_library_item === true) {\n            $(\".add-library-items\").show();\n        } else {\n            $(\".add-library-items\").hide();\n        }\n        if (this.options.contains_file_or_folder === true) {\n            if (Galaxy.user) {\n                if (!Galaxy.user.isAnonymous()) {\n                    $(\".logged-dataset-manipulation\").show();\n                    $(\".dataset-manipulation\").show();\n                } else {\n                    $(\".dataset-manipulation\").show();\n                    $(\".logged-dataset-manipulation\").hide();\n                }\n            } else {\n                $(\".logged-dataset-manipulation\").hide();\n                $(\".dataset-manipulation\").hide();\n            }\n        } else {\n            $(\".logged-dataset-manipulation\").hide();\n            $(\".dataset-manipulation\").hide();\n        }\n        this.$el.find('[data-toggle=\"tooltip\"]').tooltip({ trigger: \"hover\" });\n    },\n\n    createFolderFromModal: function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        var template = this.templateNewFolderInModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Create New Folder\"),\n            body: template(),\n            buttons: {\n                Create: () => {\n                    this.createNewFolderEvent();\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    },\n\n    createNewFolderEvent: function() {\n        var folderDetails = this.serializeNewFolder();\n        if (this.validateNewFolder(folderDetails)) {\n            var folder = new mod_library_model.FolderAsModel();\n            var url_items = Backbone.history.fragment.split(\"/\");\n            var current_folder_id;\n            if (url_items.indexOf(\"page\") > -1) {\n                current_folder_id = url_items[url_items.length - 3];\n            } else {\n                current_folder_id = url_items[url_items.length - 1];\n            }\n            folder.url = folder.urlRoot + current_folder_id;\n\n            folder.save(folderDetails, {\n                success: function(folder) {\n                    Galaxy.modal.hide();\n                    mod_toastr.success(\"Folder created.\");\n                    folder.set({ type: \"folder\" });\n                    Galaxy.libraries.folderListView.collection.add(folder);\n                },\n                error: function(model, response) {\n                    Galaxy.modal.hide();\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occurred.\");\n                    }\n                }\n            });\n        } else {\n            mod_toastr.error(\"Folder's name is missing.\");\n        }\n        return false;\n    },\n\n    serializeNewFolder: function() {\n        return {\n            name: $(\"input[name='Name']\").val(),\n            description: $(\"input[name='Description']\").val()\n        };\n    },\n\n    validateNewFolder: function(folderDetails) {\n        return folderDetails.name !== \"\";\n    },\n\n    importToHistoryModal: function(e) {\n        e.preventDefault();\n        var $checkedValues = this.findCheckedRows();\n        var template = this.templateImportIntoHistoryModal();\n        if ($checkedValues.length === 0) {\n            mod_toastr.info(\"You must select some datasets first.\");\n        } else {\n            var promise = this.fetchUserHistories();\n            promise\n                .done(() => {\n                    this.modal = Galaxy.modal;\n                    this.modal.show({\n                        closing_events: true,\n                        title: _l(\"Import into History\"),\n                        body: template({\n                            histories: this.histories.models\n                        }),\n                        buttons: {\n                            Import: () => {\n                                this.importAllIntoHistory();\n                            },\n                            Close: () => {\n                                Galaxy.modal.hide();\n                            }\n                        }\n                    });\n                })\n                .fail((model, response) => {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occurred.\");\n                    }\n                });\n        }\n    },\n\n    fetchUserHistories: function() {\n        this.histories = new mod_library_model.GalaxyHistories();\n        var promise = this.histories.fetch();\n        return promise;\n    },\n\n    importAllIntoHistory: function() {\n        this.modal.disableButton(\"Import\");\n        var new_history_name = this.modal.$(\"input[name=history_name]\").val();\n        if (new_history_name !== \"\") {\n            this.createNewHistory(new_history_name)\n                .done(new_history => {\n                    this.processImportToHistory(new_history.id, new_history.name);\n                })\n                .fail((xhr, status, error) => {\n                    mod_toastr.error(\"An error occurred.\");\n                })\n                .always(() => {\n                    this.modal.enableButton(\"Import\");\n                });\n        } else {\n            var history_id = $(\"select[name=import_to_history] option:selected\").val();\n            var history_name = $(\"select[name=import_to_history] option:selected\").text();\n            this.processImportToHistory(history_id, history_name);\n            this.modal.enableButton(\"Import\");\n        }\n    },\n\n    createNewHistory: function(new_history_name) {\n        var promise = $.post(`${Galaxy.root}api/histories`, { name: new_history_name });\n        return promise;\n    },\n\n    processImportToHistory: function(history_id, history_name) {\n        var checked_items = this.findCheckedItems();\n        var items_to_import = [];\n        // prepare the dataset objects to be imported\n        for (let i = checked_items.dataset_ids.length - 1; i >= 0; i--) {\n            var library_dataset_id = checked_items.dataset_ids[i];\n            var historyItem = new mod_library_model.HistoryItem();\n            historyItem.url = `${historyItem.urlRoot + history_id}/contents`;\n            historyItem.content = library_dataset_id;\n            historyItem.source = \"library\";\n            items_to_import.push(historyItem);\n        }\n        // prepare the folder objects to be imported\n        for (let i = checked_items.folder_ids.length - 1; i >= 0; i--) {\n            var library_folder_id = checked_items.folder_ids[i];\n            var historyItem = new mod_library_model.HistoryItem();\n            historyItem.url = `${historyItem.urlRoot + history_id}/contents`;\n            historyItem.content = library_folder_id;\n            historyItem.source = \"library_folder\";\n            items_to_import.push(historyItem);\n        }\n        this.initChainCallControl({\n            length: items_to_import.length,\n            action: \"to_history\",\n            history_name: history_name\n        });\n        // set the used history as current so user will see the last one\n        // that he imported into in the history panel on the 'analysis' page\n        jQuery.getJSON(`${Galaxy.root}history/set_as_current?id=${history_id}`);\n        this.chainCallImportingIntoHistory(items_to_import, history_name);\n    },\n\n    /**\n     * Update progress bar in modal.\n     */\n    updateProgress: function() {\n        this.progress += this.progressStep;\n        $(\".progress-bar-import\").width(`${Math.round(this.progress)}%`);\n        var txt_representation = `${Math.round(this.progress)}% Complete`;\n        $(\".completion_span\").text(txt_representation);\n    },\n\n    /**\n     * Download selected datasets. Called from the router.\n     * @param  {str} format    requested archive format\n     */\n    download: function(format) {\n        var checked_items = this.findCheckedItems();\n        var url = `${Galaxy.root}api/libraries/datasets/download/${format}`;\n        var data = { ld_ids: checked_items.dataset_ids, folder_ids: checked_items.folder_ids };\n        this.processDownload(url, data, \"get\");\n    },\n\n    /**\n     * Create hidden form and submit it through POST\n     * to initialize the download.\n     * @param  {str} url    url to call\n     * @param  {obj} data   data to include in the request\n     * @param  {str} method method of the request\n     */\n    processDownload: function(url, data, method) {\n        if (url && data) {\n            // data can be string of parameters or array/object\n            data = typeof data === \"string\" ? data : $.param(data);\n            // split params into form inputs\n            var inputs = \"\";\n            $.each(data.split(\"&\"), function() {\n                var pair = this.split(\"=\");\n                inputs += `<input type=\"hidden\" name=\"${pair[0]}\" value=\"${pair[1]}\" />`;\n            });\n            // send request\n            $(`<form action=\"${url}\" method=\"${method || \"post\"}\">${inputs}</form>`)\n                .appendTo(\"body\")\n                .submit()\n                .remove();\n            mod_toastr.info(\"Your download will begin soon.\");\n        } else {\n            mod_toastr.error(\"An error occurred.\");\n        }\n    },\n\n    addFilesFromHistoryModal: function() {\n        this.histories = new mod_library_model.GalaxyHistories();\n        this.histories\n            .fetch()\n            .done(() => {\n                this.modal = Galaxy.modal;\n                var template_modal = this.templateAddFilesFromHistory();\n                this.modal.show({\n                    closing_events: true,\n                    title: _l(\"Adding datasets from your history\"),\n                    body: template_modal({\n                        histories: this.histories.models\n                    }),\n                    buttons: {\n                        Add: () => {\n                            this.addAllDatasetsFromHistory();\n                        },\n                        Close: () => {\n                            Galaxy.modal.hide();\n                        }\n                    },\n                    closing_callback: () => {\n                        Galaxy.libraries.library_router.navigate(`folders/${this.id}`, { trigger: true });\n                    }\n                });\n                this.fetchAndDisplayHistoryContents(this.histories.models[0].id);\n                $(\"#dataset_add_bulk\").change(event => {\n                    this.fetchAndDisplayHistoryContents(event.target.value);\n                });\n            })\n            .fail((model, response) => {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    mod_toastr.error(response.responseJSON.err_msg);\n                } else {\n                    mod_toastr.error(\"An error occurred.\");\n                }\n            });\n    },\n\n    /**\n     * Create modal for importing from Galaxy path.\n     */\n    importFilesFromPathModal: function() {\n        this.modal = Galaxy.modal;\n        var template_modal = this.templateImportPathModal();\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Please enter paths to import\"),\n            body: template_modal({}),\n            buttons: {\n                Import: () => {\n                    this.importFromPathsClicked(this);\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            },\n            closing_callback: () => {\n                //  TODO: should not trigger routes outside of the router\n                Galaxy.libraries.library_router.navigate(`folders/${this.id}`, {\n                    trigger: true\n                });\n            }\n        });\n        this.renderSelectBoxes();\n    },\n\n    /**\n     * Request all extensions and genomes from Galaxy\n     * and save them in sorted arrays.\n     */\n    fetchExtAndGenomes: function() {\n        mod_utils.get({\n            url: `${Galaxy.root}api/datatypes?extension_only=False`,\n            success: datatypes => {\n                this.list_extensions = [];\n                for (let key in datatypes) {\n                    this.list_extensions.push({\n                        id: datatypes[key].extension,\n                        text: datatypes[key].extension,\n                        description: datatypes[key].description,\n                        description_url: datatypes[key].description_url\n                    });\n                }\n                this.list_extensions.sort((a, b) => (a.id > b.id ? 1 : a.id < b.id ? -1 : 0));\n                this.list_extensions.unshift(this.auto);\n            },\n            cache: true\n        });\n        mod_utils.get({\n            url: `${Galaxy.root}api/genomes`,\n            success: genomes => {\n                this.list_genomes = [];\n                for (let key in genomes) {\n                    this.list_genomes.push({\n                        id: genomes[key][1],\n                        text: genomes[key][0]\n                    });\n                }\n                this.list_genomes.sort((a, b) => (a.id > b.id ? 1 : a.id < b.id ? -1 : 0));\n            },\n            cache: true\n        });\n    },\n\n    renderSelectBoxes: function() {\n        // This won't work properly unlesss we already have the data fetched.\n        // See this.fetchExtAndGenomes()\n        this.select_genome = new mod_select.View({\n            css: \"library-genome-select\",\n            data: this.list_genomes,\n            container: Galaxy.modal.$el.find(\"#library_genome_select\"),\n            value: \"?\"\n        });\n        this.select_extension = new mod_select.View({\n            css: \"library-extension-select\",\n            data: this.list_extensions,\n            container: Galaxy.modal.$el.find(\"#library_extension_select\"),\n            value: \"auto\"\n        });\n    },\n\n    /**\n     * Create modal for importing from given directory\n     * on Galaxy. Bind jQuery events.\n     */\n    importFilesFromGalaxyFolderModal: function(options) {\n        var template_modal = this.templateBrowserModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Please select folders or files\"),\n            body: template_modal({}),\n            buttons: {\n                Import: () => {\n                    this.importFromJstreePath(this, options);\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            },\n            closing_callback: () => {\n                //  TODO: should not trigger routes outside of the router\n                Galaxy.libraries.library_router.navigate(`folders/${this.id}`, {\n                    trigger: true\n                });\n            }\n        });\n\n        $(\".libimport-select-all\").bind(\"click\", () => {\n            $(\"#jstree_browser\").jstree(\"check_all\");\n        });\n        $(\".libimport-select-none\").bind(\"click\", () => {\n            $(\"#jstree_browser\").jstree(\"uncheck_all\");\n        });\n\n        this.renderSelectBoxes();\n        options.disabled_jstree_element = \"folders\";\n        this.renderJstree(options);\n\n        $(\"input[type=radio]\").change(event => {\n            if (event.target.value === \"jstree-disable-folders\") {\n                options.disabled_jstree_element = \"folders\";\n                this.renderJstree(options);\n                $(\".jstree-folders-message\").hide();\n                $(\".jstree-preserve-structure\").hide();\n                $(\".jstree-files-message\").show();\n            } else if (event.target.value === \"jstree-disable-files\") {\n                $(\".jstree-files-message\").hide();\n                $(\".jstree-folders-message\").show();\n                $(\".jstree-preserve-structure\").show();\n                options.disabled_jstree_element = \"files\";\n                this.renderJstree(options);\n            }\n        });\n    },\n\n    /**\n     * Fetch the contents of user directory on Galaxy\n     * and render jstree component based on received\n     * data.\n     * @param  {[type]} options [description]\n     */\n    renderJstree: function(options) {\n        this.options = _.extend(this.options, options);\n        var target = options.source || \"userdir\";\n        var disabled_jstree_element = this.options.disabled_jstree_element;\n        this.jstree = new mod_library_model.Jstree();\n        this.jstree.url = `${this.jstree.urlRoot}?target=${target}&format=jstree&disable=${disabled_jstree_element}`;\n        this.jstree.fetch({\n            success: (model, response) => {\n                $(\"#jstree_browser\").jstree(\"destroy\");\n                $(\"#jstree_browser\").jstree({\n                    core: {\n                        data: model\n                    },\n                    plugins: [\"types\", \"checkbox\"],\n                    types: {\n                        folder: {\n                            icon: \"jstree-folder\"\n                        },\n                        file: {\n                            icon: \"jstree-file\"\n                        }\n                    },\n                    checkbox: {\n                        three_state: false\n                    }\n                });\n            },\n            error: (model, response) => {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    if (response.responseJSON.err_code === 404001) {\n                        mod_toastr.warning(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    }\n                } else {\n                    mod_toastr.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    /**\n     * Take the paths from the textarea, split it, create\n     * a request queue and call a function that starts sending\n     * one by one to be imported on the server.\n     */\n    importFromPathsClicked: function() {\n        var preserve_dirs = this.modal.$el.find(\".preserve-checkbox\").is(\":checked\");\n        var link_data = this.modal.$el.find(\".link-checkbox\").is(\":checked\");\n        var space_to_tab = this.modal.$el.find(\".spacetab-checkbox\").is(\":checked\");\n        var to_posix_lines = this.modal.$el.find(\".posix-checkbox\").is(\":checked\");\n        var tag_using_filenames = this.modal.$el.find(\".tag-files\").is(\":checked\");\n        var file_type = this.select_extension.value();\n        var dbkey = this.select_genome.value();\n        var paths = $(\"textarea#import_paths\").val();\n        var valid_paths = [];\n        if (!paths) {\n            mod_toastr.info(\"Please enter a path relative to Galaxy root.\");\n        } else {\n            this.modal.disableButton(\"Import\");\n            paths = paths.split(\"\\n\");\n            for (let i = paths.length - 1; i >= 0; i--) {\n                var trimmed = paths[i].trim();\n                if (trimmed.length !== 0) {\n                    valid_paths.push(trimmed);\n                }\n            }\n            this.initChainCallControl({\n                length: valid_paths.length,\n                action: \"adding_datasets\"\n            });\n            this.chainCallImportingFolders({\n                paths: valid_paths,\n                preserve_dirs: preserve_dirs,\n                link_data: link_data,\n                space_to_tab: space_to_tab,\n                to_posix_lines: to_posix_lines,\n                source: \"admin_path\",\n                file_type: file_type,\n                tag_using_filenames: tag_using_filenames,\n                dbkey: dbkey\n            });\n        }\n    },\n\n    /**\n     * Initialize the control of chaining requests\n     * in the current modal.\n     * @param {int} length The number of items in the chain call.\n     */\n    initChainCallControl: function(options) {\n        var template;\n        switch (options.action) {\n            case \"adding_datasets\":\n                template = this.templateAddingDatasetsProgressBar();\n                this.modal.$el.find(\".modal-body\").html(\n                    template({\n                        folder_name: this.options.folder_name\n                    })\n                );\n                break;\n            case \"deleting_datasets\":\n                template = this.templateDeletingItemsProgressBar();\n                this.modal.$el.find(\".modal-body\").html(template());\n                break;\n            case \"to_history\":\n                template = this.templateImportIntoHistoryProgressBar();\n                this.modal.$el.find(\".modal-body\").html(template({ history_name: options.history_name }));\n                break;\n            default:\n                Galaxy.emit.error(\"Wrong action specified.\", \"datalibs\");\n                break;\n        }\n\n        // var progress_bar_tmpl = this.templateAddingDatasetsProgressBar();\n        // this.modal.$el.find( '.modal-body' ).html( progress_bar_tmpl( { folder_name : this.options.folder_name } ) );\n        this.progress = 0;\n        this.progressStep = 100 / options.length;\n        this.options.chain_call_control.total_number = options.length;\n        this.options.chain_call_control.failed_number = 0;\n    },\n\n    /**\n     * Take the selected items from the jstree, create a request queue\n     * and send them one by one to the server for importing into\n     * the current folder.\n     *\n     * jstree.js has to be loaded before\n     * @see renderJstree\n     */\n    importFromJstreePath: function(that, options) {\n        var all_nodes = $(\"#jstree_browser\")\n            .jstree()\n            .get_selected(true);\n        // remove the disabled elements that could have been trigerred with the 'select all'\n        var selected_nodes = _.filter(all_nodes, node => node.state.disabled == false);\n        var preserve_dirs = this.modal.$el.find(\".preserve-checkbox\").is(\":checked\");\n        var link_data = this.modal.$el.find(\".link-checkbox\").is(\":checked\");\n        var space_to_tab = this.modal.$el.find(\".spacetab-checkbox\").is(\":checked\");\n        var to_posix_lines = this.modal.$el.find(\".posix-checkbox\").is(\":checked\");\n        var file_type = this.select_extension.value();\n        var dbkey = this.select_genome.value();\n        var tag_using_filenames = this.modal.$el.find(\".tag-files\").is(\":checked\");\n        var selection_type = selected_nodes[0].type;\n        var paths = [];\n        if (selected_nodes.length < 1) {\n            mod_toastr.info(\"Please select some items first.\");\n        } else {\n            this.modal.disableButton(\"Import\");\n            for (let i = selected_nodes.length - 1; i >= 0; i--) {\n                if (selected_nodes[i].li_attr.full_path !== undefined) {\n                    paths.push(selected_nodes[i].li_attr.full_path);\n                }\n            }\n            this.initChainCallControl({\n                length: paths.length,\n                action: \"adding_datasets\"\n            });\n            if (selection_type === \"folder\") {\n                var full_source = `${options.source}_folder`;\n                this.chainCallImportingFolders({\n                    paths: paths,\n                    preserve_dirs: preserve_dirs,\n                    link_data: link_data,\n                    space_to_tab: space_to_tab,\n                    to_posix_lines: to_posix_lines,\n                    source: full_source,\n                    file_type: file_type,\n                    dbkey: dbkey,\n                    tag_using_filenames: tag_using_filenames\n                });\n            } else if (selection_type === \"file\") {\n                var full_source = `${options.source}_file`;\n                this.chainCallImportingUserdirFiles({\n                    paths: paths,\n                    file_type: file_type,\n                    dbkey: dbkey,\n                    link_data: link_data,\n                    space_to_tab: space_to_tab,\n                    to_posix_lines: to_posix_lines,\n                    source: full_source,\n                    tag_using_filenames: tag_using_filenames\n                });\n            }\n        }\n    },\n\n    fetchAndDisplayHistoryContents: function(history_id) {\n        var history_contents = new mod_library_model.HistoryContents({\n            id: history_id\n        });\n        history_contents.fetch({\n            success: history_contents => {\n                var history_contents_template = this.templateHistoryContents();\n                this.histories.get(history_id).set({ contents: history_contents });\n                this.modal.$el.find(\".library_selected_history_content\").html(\n                    history_contents_template({\n                        history_contents: history_contents.models.reverse()\n                    })\n                );\n                this.modal.$el.find(\".history-import-select-all\").bind(\"click\", () => {\n                    $(\".library_selected_history_content [type=checkbox]\").prop(\"checked\", true);\n                });\n                this.modal.$el.find(\".history-import-unselect-all\").bind(\"click\", () => {\n                    $(\".library_selected_history_content [type=checkbox]\").prop(\"checked\", false);\n                });\n            },\n            error: (model, response) => {\n                if (typeof response.responseJSON !== \"undefined\") {\n                    mod_toastr.error(response.responseJSON.err_msg);\n                } else {\n                    mod_toastr.error(\"An error occurred.\");\n                }\n            }\n        });\n    },\n\n    /**\n     * Import all selected datasets from history into the current folder.\n     */\n    addAllDatasetsFromHistory: function() {\n        var checked_hdas = this.modal.$el.find(\".library_selected_history_content\").find(\":checked\");\n        var history_item_ids = []; // can be hda or hdca\n        var history_item_types = [];\n        var items_to_add = [];\n        if (checked_hdas.length < 1) {\n            mod_toastr.info(\"You must select some datasets first.\");\n        } else {\n            this.modal.disableButton(\"Add\");\n            checked_hdas.each(function() {\n                var hid = $(this)\n                    .closest(\"li\")\n                    .data(\"id\");\n                if (hid) {\n                    var item_type = $(this)\n                        .closest(\"li\")\n                        .data(\"name\");\n                    history_item_ids.push(hid);\n                    history_item_types.push(item_type);\n                }\n            });\n            for (let i = history_item_ids.length - 1; i >= 0; i--) {\n                var history_item_id = history_item_ids[i];\n                var folder_item = new mod_library_model.Item();\n                folder_item.url = `${Galaxy.root}api/folders/${this.options.id}/contents`;\n                if (history_item_types[i] === \"collection\") {\n                    folder_item.set({ from_hdca_id: history_item_id });\n                } else {\n                    folder_item.set({ from_hda_id: history_item_id });\n                }\n                items_to_add.push(folder_item);\n            }\n            this.initChainCallControl({\n                length: items_to_add.length,\n                action: \"adding_datasets\"\n            });\n            this.chainCallAddingHdas(items_to_add);\n        }\n    },\n\n    /**\n     * Take array of empty history items and make request for each of them\n     * to create it on server. Update progress in between calls.\n     * @param  {array} history_item_set array of empty history items\n     * @param  {str} history_name     name of the history to import to\n     */\n    chainCallImportingIntoHistory: function(history_item_set, history_name) {\n        var popped_item = history_item_set.pop();\n        if (typeof popped_item == \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                mod_toastr.success(\"Selected datasets imported into history. Click this to start analyzing it.\", \"\", {\n                    onclick: () => {\n                        window.location = Galaxy.root;\n                    }\n                });\n            } else if (this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number) {\n                mod_toastr.error(\"There was an error and no datasets were imported into history.\");\n            } else if (this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number) {\n                mod_toastr.warning(\n                    \"Some of the datasets could not be imported into history. Click this to see what was imported.\",\n                    \"\",\n                    {\n                        onclick: () => {\n                            window.location = Galaxy.root;\n                        }\n                    }\n                );\n            }\n            Galaxy.modal.hide();\n            return true;\n        }\n        var promise = $.when(\n            popped_item.save({\n                content: popped_item.content,\n                source: popped_item.source\n            })\n        );\n\n        promise\n            .done(() => {\n                this.updateProgress();\n                this.chainCallImportingIntoHistory(history_item_set, history_name);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallImportingIntoHistory(history_item_set, history_name);\n            });\n    },\n\n    /**\n     * Take the array of paths and create a request for each of them\n     * calling them in chain. Update the progress bar in between each.\n     * @param  {array} paths                    paths relative to user folder on Galaxy\n     * @param  {boolean} tag_using_filenames    add tags to datasets using names of files\n     */\n    chainCallImportingUserdirFiles: function(options) {\n        var popped_item = options.paths.pop();\n        if (typeof popped_item === \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                mod_toastr.success(\"Selected files imported into the current folder\");\n                Galaxy.modal.hide();\n            } else {\n                mod_toastr.error(\"An error occured.\");\n            }\n            return true;\n        }\n        var promise = $.when(\n            $.post(\n                `${Galaxy.root}api/libraries/datasets?encoded_folder_id=${this.id}&source=${\n                    options.source\n                }&path=${popped_item}&file_type=${options.file_type}&link_data=${options.link_data}&space_to_tab=${\n                    options.space_to_tab\n                }&to_posix_lines=${options.to_posix_lines}&dbkey=${options.dbkey}&tag_using_filenames=${\n                    options.tag_using_filenames\n                }`\n            )\n        );\n        promise\n            .done(response => {\n                this.updateProgress();\n                this.chainCallImportingUserdirFiles(options);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallImportingUserdirFiles(options);\n            });\n    },\n\n    /**\n     * Take the array of paths and create a request for each of them\n     * calling them in series. Update the progress bar in between each.\n     * @param  {array} paths                    paths relative to Galaxy root folder\n     * @param  {boolean} preserve_dirs          indicates whether to preserve folder structure\n     * @param  {boolean} link_data              copy files to Galaxy or link instead\n     * @param  {boolean} to_posix_lines         convert line endings to POSIX standard\n     * @param  {boolean} space_to_tab           convert spaces to tabs\n     * @param  {str} source                     string representing what type of folder\n     *                                          is the source of import\n     * @param  {boolean} tag_using_filenames    add tags to datasets using names of files\n     */\n    chainCallImportingFolders: function(options) {\n        // TODO need to check which paths to call\n        var popped_item = options.paths.pop();\n        if (typeof popped_item == \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                mod_toastr.success(\"Selected folders and their contents imported into the current folder.\");\n                Galaxy.modal.hide();\n            } else {\n                // TODO better error report\n                mod_toastr.error(\"An error occured.\");\n            }\n            return true;\n        }\n        var promise = $.when(\n            $.post(\n                `${Galaxy.root}api/libraries/datasets?encoded_folder_id=${this.id}&source=${\n                    options.source\n                }&path=${popped_item}&preserve_dirs=${options.preserve_dirs}&link_data=${\n                    options.link_data\n                }&to_posix_lines=${options.to_posix_lines}&space_to_tab=${options.space_to_tab}&file_type=${\n                    options.file_type\n                }&dbkey=${options.dbkey}&tag_using_filenames=${options.tag_using_filenames}`\n            )\n        );\n        promise\n            .done(response => {\n                this.updateProgress();\n                this.chainCallImportingFolders(options);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallImportingFolders(options);\n            });\n    },\n\n    /**\n     * Take the array of hdas and create a request for each.\n     * Call them in chain and update progress bar in between each.\n     * @param  {array} hdas_set array of empty hda objects\n     */\n    chainCallAddingHdas: function(hdas_set) {\n        this.added_hdas = new mod_library_model.Folder();\n        var popped_item = hdas_set.pop();\n        if (typeof popped_item == \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                mod_toastr.success(\"Selected datasets from history added to the folder\");\n            } else if (this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number) {\n                mod_toastr.error(\"There was an error and no datasets were added to the folder.\");\n            } else if (this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number) {\n                mod_toastr.warning(\"Some of the datasets could not be added to the folder\");\n            }\n            Galaxy.modal.hide();\n            return this.added_hdas;\n        }\n        var promise = $.when(\n            popped_item.save({\n                from_hda_id: popped_item.get(\"from_hda_id\")\n            })\n        );\n\n        promise\n            .done(model => {\n                Galaxy.libraries.folderListView.collection.add(model);\n                this.updateProgress();\n                this.chainCallAddingHdas(hdas_set);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallAddingHdas(hdas_set);\n            });\n    },\n\n    /**\n     * Take the array of lddas, create request for each and\n     * call them in chain. Update progress bar in between each.\n     * @param  {array} lddas_set array of lddas to delete\n     */\n    chainCallDeletingItems: function(items_to_delete) {\n        this.deleted_items = new mod_library_model.Folder();\n        var item_to_delete = items_to_delete.pop();\n        if (typeof item_to_delete === \"undefined\") {\n            if (this.options.chain_call_control.failed_number === 0) {\n                mod_toastr.success(\"Selected items were deleted.\");\n            } else if (this.options.chain_call_control.failed_number === this.options.chain_call_control.total_number) {\n                mod_toastr.error(\n                    \"There was an error and no items were deleted. Please make sure you have sufficient permissions.\"\n                );\n            } else if (this.options.chain_call_control.failed_number < this.options.chain_call_control.total_number) {\n                mod_toastr.warning(\n                    \"Some of the items could not be deleted. Please make sure you have sufficient permissions.\"\n                );\n            }\n            Galaxy.modal.hide();\n            return this.deleted_items;\n        }\n        item_to_delete\n            .destroy()\n            .done(item => {\n                Galaxy.libraries.folderListView.collection.remove(item_to_delete.id);\n                this.updateProgress();\n                // add the deleted item to collection, triggers rendering\n                if (Galaxy.libraries.folderListView.options.include_deleted) {\n                    var updated_item = null;\n                    if (item.type === \"folder\" || item.model_class === \"LibraryFolder\") {\n                        updated_item = new mod_library_model.FolderAsModel(item);\n                    } else if (item.type === \"file\" || item.model_class === \"LibraryDataset\") {\n                        updated_item = new mod_library_model.Item(item);\n                    } else {\n                        Galaxy.emit.error(\"Unknown library item type found.\", \"datalibs\");\n                        Galaxy.emit.error(item.type || item.model_class, \"datalibs\");\n                    }\n                    Galaxy.libraries.folderListView.collection.add(updated_item);\n                }\n                this.chainCallDeletingItems(items_to_delete);\n            })\n            .fail(() => {\n                this.options.chain_call_control.failed_number += 1;\n                this.updateProgress();\n                this.chainCallDeletingItems(items_to_delete);\n            });\n    },\n\n    /**\n     * Handles the click on 'show deleted' checkbox\n     */\n    checkIncludeDeleted: function(event) {\n        if (event.target.checked) {\n            Galaxy.libraries.folderListView.fetchFolder({\n                include_deleted: true\n            });\n        } else {\n            Galaxy.libraries.folderListView.fetchFolder({\n                include_deleted: false\n            });\n        }\n    },\n\n    /**\n     * Delete the selected items. Atomic. One by one.\n     */\n    deleteSelectedItems: function() {\n        var dataset_ids = [];\n        var folder_ids = [];\n        var $checkedValues = this.findCheckedRows();\n        if ($checkedValues.length === 0) {\n            mod_toastr.info(\"You must select at least one item for deletion.\");\n        } else {\n            var template = this.templateDeletingItemsProgressBar();\n            this.modal = Galaxy.modal;\n            this.modal.show({\n                closing_events: true,\n                title: _l(\"Deleting selected items\"),\n                body: template({}),\n                buttons: {\n                    Close: () => {\n                        Galaxy.modal.hide();\n                    }\n                }\n            });\n            // init the control counters\n            this.options.chain_call_control.total_number = 0;\n            this.options.chain_call_control.failed_number = 0;\n            $checkedValues.each(function() {\n                var row_id = $(this)\n                    .closest(\"tr\")\n                    .data(\"id\");\n                if (row_id !== undefined) {\n                    if (row_id.substring(0, 1) == \"F\") {\n                        folder_ids.push(row_id);\n                    } else {\n                        dataset_ids.push(row_id);\n                    }\n                }\n            });\n            // init the progress bar\n            var items_total = dataset_ids.length + folder_ids.length;\n            this.progressStep = 100 / items_total;\n            this.progress = 0;\n\n            // prepare the dataset items to be added\n            var items_to_delete = [];\n            for (let i = dataset_ids.length - 1; i >= 0; i--) {\n                var dataset = new mod_library_model.Item({\n                    id: dataset_ids[i]\n                });\n                items_to_delete.push(dataset);\n            }\n            for (let i = folder_ids.length - 1; i >= 0; i--) {\n                var folder = new mod_library_model.FolderAsModel({\n                    id: folder_ids[i]\n                });\n                items_to_delete.push(folder);\n            }\n\n            this.options.chain_call_control.total_number = items_total;\n            // call the recursive function to call ajax one after each other (request FIFO queue)\n            this.chainCallDeletingItems(items_to_delete);\n        }\n    },\n\n    showLocInfo: function() {\n        var library = null;\n        if (Galaxy.libraries.libraryListView !== null) {\n            library = Galaxy.libraries.libraryListView.collection.get(this.options.parent_library_id);\n            this.showLocInfoModal(library);\n        } else {\n            library = new mod_library_model.Library({\n                id: this.options.parent_library_id\n            });\n            library.fetch({\n                success: () => {\n                    this.showLocInfoModal(library);\n                },\n                error: function(model, response) {\n                    if (typeof response.responseJSON !== \"undefined\") {\n                        mod_toastr.error(response.responseJSON.err_msg);\n                    } else {\n                        mod_toastr.error(\"An error occurred.\");\n                    }\n                }\n            });\n        }\n    },\n\n    showLocInfoModal: function(library) {\n        var template = this.templateLocInfoInModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: _l(\"Location Details\"),\n            body: template({ library: library, options: this.options }),\n            buttons: {\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n    },\n\n    showImportModal: function(options) {\n        switch (options.source) {\n            case \"history\":\n                this.addFilesFromHistoryModal();\n                break;\n            case \"importdir\":\n                this.importFilesFromGalaxyFolderModal({\n                    source: \"importdir\"\n                });\n                break;\n            case \"path\":\n                this.importFilesFromPathModal();\n                break;\n            case \"userdir\":\n                this.importFilesFromGalaxyFolderModal({\n                    source: \"userdir\"\n                });\n                break;\n            default:\n                Galaxy.libraries.library_router.back();\n                mod_toastr.error(\"Invalid import source.\");\n                break;\n        }\n    },\n\n    /**\n     * Show user the prompt to change the number of items shown on page.\n     */\n    showPageSizePrompt: function(e) {\n        e.preventDefault();\n        var folder_page_size = prompt(\n            \"How many items per page do you want to see?\",\n            Galaxy.libraries.preferences.get(\"folder_page_size\")\n        );\n        if (folder_page_size != null && folder_page_size == parseInt(folder_page_size)) {\n            Galaxy.libraries.preferences.set({\n                folder_page_size: parseInt(folder_page_size)\n            });\n            Galaxy.libraries.folderListView.render({\n                id: this.options.id,\n                show_page: 1\n            });\n        }\n    },\n\n    findCheckedRows: function() {\n        return $(\"#folder_list_body\").find(\":checked\");\n    },\n\n    findCheckedItems: function() {\n        var folder_ids = [];\n        var dataset_ids = [];\n        this.findCheckedRows().each(function() {\n            var row_id = $(this)\n                .closest(\"tr\")\n                .data(\"id\");\n            if (row_id.substring(0, 1) == \"F\") {\n                folder_ids.push(row_id);\n            } else {\n                dataset_ids.push(row_id);\n            }\n        });\n        return { folder_ids: folder_ids, dataset_ids: dataset_ids };\n    },\n\n    showCollectionSelect: function(e) {\n        e.preventDefault();\n        var checked_items = this.findCheckedItems();\n        var template = this.templateCollectionSelectModal();\n        this.modal = Galaxy.modal;\n        this.modal.show({\n            closing_events: true,\n            title: \"Create History Collection from Datasets\",\n            body: template({ selected_datasets: checked_items.dataset_ids.length }),\n            buttons: {\n                Continue: () => {\n                    this.showColectionBuilder(checked_items.dataset_ids);\n                },\n                Close: () => {\n                    Galaxy.modal.hide();\n                }\n            }\n        });\n        this.prepareCollectionTypeSelect();\n        this.prepareHistoryTypeSelect();\n    },\n\n    prepareCollectionTypeSelect: function() {\n        this.collectionType = \"list\";\n        this.select_collection_type = new mod_select.View({\n            css: \"library-collection-type-select\",\n            container: this.modal.$el.find(\".library-collection-type-select\"),\n            data: [\n                { id: \"list\", text: \"List\" },\n                { id: \"paired\", text: \"Paired\" },\n                { id: \"list:paired\", text: \"List of Pairs\" },\n                { id: \"rules\", text: \"From Rules\" }\n            ],\n            value: \"list\",\n            onchange: collectionType => {\n                this.updateCollectionType(collectionType);\n            }\n        });\n    },\n\n    prepareHistoryTypeSelect: function() {\n        var promise = this.fetchUserHistories();\n        promise.done(() => {\n            var history_options = [];\n            for (let i = this.histories.length - 1; i >= 0; i--) {\n                history_options.unshift({\n                    id: this.histories.models[i].id,\n                    text: this.histories.models[i].get(\"name\")\n                });\n            }\n            this.select_collection_history = new mod_select.View({\n                css: \"library-collection-history-select\",\n                container: this.modal.$el.find(\".library-collection-history-select\"),\n                data: history_options,\n                value: history_options[0].id\n            });\n        });\n    },\n\n    /** Update collection type */\n    updateCollectionType: function(collectionType) {\n        this.collectionType = collectionType;\n    },\n\n    showColectionBuilder: function(checked_items) {\n        let collection_elements = [];\n        let elements_source = this.modal.$('input[type=\"radio\"]:checked').val();\n        if (elements_source === \"selection\") {\n            for (let i = checked_items.length - 1; i >= 0; i--) {\n                let collection_item = {};\n                let dataset = Galaxy.libraries.folderListView.folder_container.get(\"folder\").get(checked_items[i]);\n                collection_item.id = checked_items[i];\n                collection_item.name = dataset.get(\"name\");\n                collection_item.deleted = dataset.get(\"deleted\");\n                collection_item.state = dataset.get(\"state\");\n                collection_elements.push(collection_item);\n            }\n        } else if (elements_source === \"folder\") {\n            collection_elements = new Backbone.Collection(\n                Galaxy.libraries.folderListView.folder_container.get(\"folder\").where({ type: \"file\" })\n            ).toJSON();\n        }\n        let new_history_name = this.modal.$(\"input[name=history_name]\").val();\n        if (new_history_name !== \"\") {\n            this.createNewHistory(new_history_name)\n                .done(new_history => {\n                    mod_toastr.success(\"History created\");\n                    this.collectionImport(collection_elements, new_history.id, new_history.name);\n                })\n                .fail((xhr, status, error) => {\n                    mod_toastr.error(\"An error occurred.\");\n                });\n        } else {\n            let selected_history_id = this.select_collection_history.value();\n            let selected_history_name = this.select_collection_history.text();\n            this.collectionImport(collection_elements, selected_history_id, selected_history_name);\n        }\n    },\n\n    collectionImport: function(collection_elements, history_id, history_name) {\n        let modal_title = `Creating Collection in ${history_name}`;\n        let creator_class;\n        let creationFn;\n        if (this.collectionType === \"list\") {\n            creator_class = LIST_CREATOR.ListCollectionCreator;\n            creationFn = (elements, name, hideSourceItems) => {\n                elements = elements.map(element => ({\n                    id: element.id,\n                    name: element.name,\n                    src: \"ldda\"\n                }));\n                return this.createHDCA(elements, this.collectionType, name, hideSourceItems, history_id);\n            };\n            LIST_CREATOR.collectionCreatorModal(\n                collection_elements,\n                { creationFn: creationFn, title: modal_title, defaultHideSourceItems: true },\n                creator_class\n            );\n        } else if (this.collectionType === \"paired\") {\n            creator_class = PAIR_CREATOR.PairCollectionCreator;\n            creationFn = (elements, name, hideSourceItems) => {\n                elements = [\n                    { name: \"forward\", src: \"ldda\", id: elements[0].id },\n                    { name: \"reverse\", src: \"ldda\", id: elements[1].id }\n                ];\n                return this.createHDCA(elements, this.collectionType, name, hideSourceItems, history_id);\n            };\n            LIST_CREATOR.collectionCreatorModal(\n                collection_elements,\n                { creationFn: creationFn, title: modal_title, defaultHideSourceItems: true },\n                creator_class\n            );\n        } else if (this.collectionType === \"list:paired\") {\n            let elements = collection_elements.map(element => ({\n                id: element.id,\n                name: element.name,\n                src: \"ldda\"\n            }));\n            PAIRED_CREATOR.pairedCollectionCreatorModal(elements, {\n                historyId: history_id,\n                title: modal_title,\n                defaultHideSourceItems: true\n            });\n        } else if (this.collectionType === \"rules\") {\n            const creationFn = (elements, collectionType, name, hideSourceItems) => {\n                return this.createHDCA(elements, collectionType, name, hideSourceItems, history_id);\n            };\n            LIST_CREATOR.ruleBasedCollectionCreatorModal(collection_elements, \"library_datasets\", \"collections\", {\n                creationFn: creationFn,\n                defaultHideSourceItems: true\n            });\n        }\n    },\n\n    createHDCA: function(elementIdentifiers, collectionType, name, hideSourceItems, history_id, options) {\n        let hdca = new HDCA_MODEL.HistoryDatasetCollection({\n            history_content_type: \"dataset_collection\",\n            collection_type: collectionType,\n            history_id: history_id,\n            name: name,\n            hide_source_items: hideSourceItems || false,\n            element_identifiers: elementIdentifiers\n        });\n        return hdca.save(options);\n    },\n\n    templateToolBar: function() {\n        return _.template(\n            [\n                '<div class=\"library_style_container\">', // container start\n                '<div class=\"d-flex align-items-center mb-2\">',\n                '<span class=\"mr-1\">DATA LIBRARIES</span>',\n                \"<div>\", // toolbar start\n                '<form class=\"form-inline\">',\n                '<div class=\"form-check logged-dataset-manipulation mr-1\" style=\"display:none;\">', // include deleted checkbox\n                '<input class=\"form-check-input include-deleted-datasets-chk\" id=\"include_deleted_datasets_chk\" type=\"checkbox\">',\n                '<label class=\"form-check-label\" for=\"include_deleted_datasets_chk\">include deleted</label>',\n                \"</div>\",\n                '<button style=\"display:none;\" title=\"Create new folder\" class=\"btn btn-secondary toolbtn-create-folder add-library-items add-library-items-folder mr-1\" type=\"button\">',\n                '<span class=\"fa fa-plus\"></span> <span class=\"fa fa-folder\"></span> Create Folder ',\n                \"</button>\",\n                \"<% if(multiple_add_dataset_options) { %>\", // add datasets button\n                '<div data-toggle=\"tooltip\" data-placement=\"right\" title=\"Add datasets to current folder\" class=\"dropdown add-library-items add-library-items-datasets mr-1\" style=\"display:none;\">',\n                '<button type=\"button\" class=\"btn btn-secondary dropdown-toggle\" data-toggle=\"dropdown\">',\n                '<span class=\"fa fa-plus\"></span> <span class=\"fa fa-file\"></span> Add Datasets <span class=\"caret\"></span>',\n                \"</button>\",\n                '<div class=\"dropdown-menu\">',\n                '<a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/history\"> from History</a>',\n                \"<% if(Galaxy.config.user_library_import_dir !== null) { %>\",\n                '<a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/userdir\"> from User Directory</a>',\n                \"<% } %>\",\n                \"<% if(Galaxy.config.library_import_dir !== null || Galaxy.config.allow_library_path_paste) { %>\",\n                '<h5 class=\"dropdown-header\">Admins only</h5>',\n                \"<% if(Galaxy.config.library_import_dir !== null) { %>\",\n                '<a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/importdir\">from Import Directory</a>',\n                \"<% } %>\",\n                \"<% if(Galaxy.config.allow_library_path_paste) { %>\",\n                '<a class=\"dropdown-item\" href=\"#folders/<%= id %>/import/path\">from Path</a>',\n                \"<% } %>\",\n                \"<% } %>\",\n                \"</div>\",\n                \"</div>\",\n\n                \"<% } else { %>\",\n                '<a data-placement=\"top\" title=\"Add Datasets to Current Folder\" style=\"display:none;\" class=\"btn btn-secondary add-library-items add-library-items-datasets\" href=\"#folders/<%= id %>/import/history\" role=\"button\">',\n                '<span class=\"fa fa-plus\"></span><span class=\"fa fa-file\"></span>',\n                \"</a>\",\n                \"<% } %>\",\n                // import to history button\n                '<div data-toggle=\"tooltip\" data-placement=\"right\" title=\"Import to history\" class=\"dropdown mr-1\">',\n                '<button type=\"button\" class=\"primary-button dropdown-toggle add-to-history\" data-toggle=\"dropdown\">',\n                '<span class=\"fa fa-book\"></span> To History <span class=\"caret\"></span>',\n                \"</button>\",\n                '<div class=\"dropdown-menu\" role=\"menu\">',\n                '<a href=\"\" class=\"toolbtn-bulk-import add-to-history-datasets dropdown-item\">as Datasets</a>',\n                '<a href=\"\" class=\"toolbtn-collection-import add-to-history-collection dropdown-item\">as a Collection</a>',\n                \"</div>\",\n                \"</div>\",\n                // download button\n                '<div data-toggle=\"tooltip\" data-placement=\"right\" title=\"Download items as archive\" class=\"dropdown dataset-manipulation mr-1\" style=\"display:none; \">',\n                '<button type=\"button\" class=\"primary-button dropdown-toggle\" data-toggle=\"dropdown\">',\n                '<span class=\"fa fa-save\"></span> Download <span class=\"caret\"></span>',\n                \"</button>\",\n                '<div class=\"dropdown-menu\" role=\"menu\">',\n                '<a class=\"dropdown-item\" href=\"#/folders/<%= id %>/download/tgz\">.tar.gz</a>',\n                '<a class=\"dropdown-item\" href=\"#/folders/<%= id %>/download/tbz\">.tar.bz</a>',\n                '<a class=\"dropdown-item\" href=\"#/folders/<%= id %>/download/zip\">.zip</a>',\n                \"</div>\",\n                \"</div>\",\n                // delete button\n                '<button data-toggle=\"tooltip\" data-placement=\"right\" title=\"Mark items deleted\" class=\"primary-button toolbtn-bulk-delete logged-dataset-manipulation mr-1\" style=\"display:none;\" type=\"button\">',\n                '<span class=\"fa fa-trash\"></span> Delete',\n                \"</button>\",\n                '<span class=\"mr-1\" data-toggle=\"tooltip\" data-placement=\"right\" title=\"Show location details\">', // location button\n                '<button data-id=\"<%- id %>\" class=\"primary-button toolbtn-show-locinfo\" type=\"button\">',\n                '<span class=\"fa fa-info-circle\"></span>',\n                \"&nbsp;Details\",\n                \"</button>\",\n                \"</span>\",\n                '<span data-toggle=\"tooltip\" data-placement=\"right\" title=\"See this screen annotated\">', // help button\n                '<a class=\"library-help-button\" href=\"https://galaxyproject.org/data-libraries/screen/folder-contents/\" target=\"_blank\">',\n                '<button class=\"primary-button\" type=\"button\">',\n                '<span class=\"fa fa-question-circle\"></span>',\n                \"&nbsp;Help\",\n                \"</button>\",\n                \"</a>\",\n                \"</span>\",\n                \"</form>\",\n                \"</div>\", // toolbar end\n                \"</div>\", // end flex\n                '<div id=\"folder_items_element\" />', // folder contents will append here\n                '<div class=\"d-flex justify-content-center align-items-center folder-paginator mt-2 mb-2\" />', // paginator will append here\n                \"</div>\" // container end\n            ].join(\"\")\n        );\n    },\n\n    templateLocInfoInModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                '<table class=\"grid table table-sm\">',\n                \"<thead>\",\n                '<th style=\"width: 25%;\">library</th>',\n                \"<th></th>\",\n                \"</thead>\",\n                \"<tbody>\",\n                \"<tr>\",\n                \"<td>name</td>\",\n                '<td><%- library.get(\"name\") %></td>',\n                \"</tr>\",\n                '<% if(library.get(\"description\") !== \"\") { %>',\n                \"<tr>\",\n                \"<td>description</td>\",\n                '<td><%- library.get(\"description\") %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if(library.get(\"synopsis\") !== \"\") { %>',\n                \"<tr>\",\n                \"<td>synopsis</td>\",\n                '<td><%- library.get(\"synopsis\") %></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                '<% if(library.get(\"create_time_pretty\") !== \"\") { %>',\n                \"<tr>\",\n                \"<td>created</td>\",\n                '<td><span title=\"<%- library.get(\"create_time\") %>\"><%- library.get(\"create_time_pretty\") %></span></td>',\n                \"</tr>\",\n                \"<% } %>\",\n                \"<tr>\",\n                \"<td>id</td>\",\n                '<td><%- library.get(\"id\") %></td>',\n                \"</tr>\",\n                \"</tbody>\",\n                \"</table>\",\n                '<table class=\"grid table table-sm\">',\n                \"<thead>\",\n                '<th style=\"width: 25%;\">folder</th>',\n                \"<th></th>\",\n                \"</thead>\",\n                \"<tbody>\",\n                \"<tr>\",\n                \"<td>name</td>\",\n                \"<td><%- options.folder_name %></td>\",\n                \"</tr>\",\n                '<% if(options.folder_description !== \"\") { %>',\n                \"<tr>\",\n                \"<td>description</td>\",\n                \"<td><%- options.folder_description %></td>\",\n                \"</tr>\",\n                \"<% } %>\",\n                \"<tr>\",\n                \"<td>id</td>\",\n                \"<td><%- options.id %></td>\",\n                \"</tr>\",\n                \"</tbody>\",\n                \"</table>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateNewFolderInModal: function() {\n        return _.template(\n            [\n                '<div id=\"new_folder_modal\">',\n                \"<form>\",\n                '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n                '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n                \"</form>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateImportIntoHistoryModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                '<div class=\"library-modal-item\">',\n                \"Select history: \",\n                '<select name=\"import_to_history\" style=\"width:50%; margin-bottom: 1em; \" autofocus>',\n                \"<% _.each(histories, function(history) { %>\",\n                '<option value=\"<%= _.escape(history.get(\"id\")) %>\"><%= _.escape(history.get(\"name\")) %></option>',\n                \"<% }); %>\",\n                \"</select>\",\n                \"</div>\",\n                '<div class=\"library-modal-item\">',\n                \"or create new: \",\n                '<input type=\"text\" name=\"history_name\" value=\"\" placeholder=\"name of the new history\" style=\"width:50%;\" />',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateImportIntoHistoryProgressBar: function() {\n        return _.template(\n            [\n                '<div class=\"import_text\">',\n                \"Importing selected items to history <b><%= _.escape(history_name) %></b>\",\n                \"</div>\",\n                '<div class=\"progress\">',\n                '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n                '<span class=\"completion_span\">0% Complete</span>',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateAddingDatasetsProgressBar: function() {\n        return _.template(\n            [\n                '<div class=\"import_text\">',\n                \"Adding selected datasets to library folder <b><%= _.escape(folder_name) %></b>\",\n                \"</div>\",\n                '<div class=\"progress\">',\n                '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n                '<span class=\"completion_span\">0% Complete</span>',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateDeletingItemsProgressBar: function() {\n        return _.template(\n            [\n                '<div class=\"import_text\">',\n                \"</div>\",\n                '<div class=\"progress\">',\n                '<div class=\"progress-bar progress-bar-import\" role=\"progressbar\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\" style=\"width: 00%;\">',\n                '<span class=\"completion_span\">0% Complete</span>',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateBrowserModal: function() {\n        return _.template(\n            [\n                '<div id=\"file_browser_modal\">',\n                '<div style=\"margin-bottom:1em;\">',\n                '<label title=\"Switch to selecting files\" class=\"radio-inline import-type-switch\">',\n                '<input type=\"radio\" name=\"jstree-radio\" value=\"jstree-disable-folders\" checked=\"checked\"> Choose Files',\n                \"</label>\",\n                '<label title=\"Switch to selecting folders\" class=\"radio-inline import-type-switch\">',\n                '<input type=\"radio\" name=\"jstree-radio\" value=\"jstree-disable-files\"> Choose Folders',\n                \"</label>\",\n                \"</div>\",\n                '<div class=\"alert alert-info jstree-files-message\">All files you select will be imported into the current folder ignoring their folder structure.</div>',\n                '<div class=\"alert alert-info jstree-folders-message\" style=\"display:none;\">All files within the selected folders and their subfolders will be imported into the current folder.</div>',\n                '<div style=\"margin-bottom:1em;\">',\n                '<label class=\"checkbox-inline jstree-preserve-structure\" style=\"display:none;\">',\n                '<input class=\"preserve-checkbox\" type=\"checkbox\" value=\"preserve_directory_structure\">',\n                \"Preserve directory structure\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"link-checkbox\" type=\"checkbox\" value=\"link_files\">',\n                \"Link files instead of copying\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"posix-checkbox\" type=\"checkbox\" value=\"to_posix_lines\" checked=\"checked\">',\n                \"Convert line endings to POSIX\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"spacetab-checkbox\" type=\"checkbox\" value=\"space_to_tab\">',\n                \"Convert spaces to tabs\",\n                \"</label>\",\n                \"</div>\",\n                '<button title=\"Select all files\" type=\"button\" class=\"button primary-button libimport-select-all\">',\n                \"Select all\",\n                \"</button>\",\n                '<button title=\"Select no files\" type=\"button\" class=\"button primary-button libimport-select-none\">',\n                \"Unselect all\",\n                \"</button>\",\n                \"<hr />\",\n                // append jstree object here\n                '<div id=\"jstree_browser\">',\n                \"</div>\",\n                \"<hr />\",\n                \"<p>You can set extension type and genome for all imported datasets at once:</p>\",\n                \"<div>\",\n                'Type: <span id=\"library_extension_select\" class=\"library-extension-select\" />',\n                'Genome: <span id=\"library_genome_select\" class=\"library-genome-select\" />',\n                \"</div>\",\n                \"<br>\",\n                \"<div>\",\n                '<label class=\"checkbox-inline tag-files\">',\n                \"Tag datasets based on file names\",\n                '<input class=\"tag-files\" type=\"checkbox\" value=\"tag_using_filenames\">',\n                \"</label>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateImportPathModal: function() {\n        return _.template(\n            [\n                '<div id=\"file_browser_modal\">',\n                '<div class=\"alert alert-info jstree-folders-message\">All files within the given folders and their subfolders will be imported into the current folder.</div>',\n                '<div style=\"margin-bottom: 0.5em;\">',\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"preserve-checkbox\" type=\"checkbox\" value=\"preserve_directory_structure\">',\n                \"Preserve directory structure\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"link-checkbox\" type=\"checkbox\" value=\"link_files\">',\n                \"Link files instead of copying\",\n                \"</label>\",\n                \"<br>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"posix-checkbox\" type=\"checkbox\" value=\"to_posix_lines\" checked=\"checked\">',\n                \"Convert line endings to POSIX\",\n                \"</label>\",\n                '<label class=\"checkbox-inline\">',\n                '<input class=\"spacetab-checkbox\" type=\"checkbox\" value=\"space_to_tab\">',\n                \"Convert spaces to tabs\",\n                \"</label>\",\n                \"</div>\",\n                '<textarea id=\"import_paths\" class=\"form-control\" rows=\"5\" placeholder=\"Absolute paths (or paths relative to Galaxy root) separated by newline\" autofocus></textarea>',\n                \"<hr />\",\n                \"<p>You can set extension type and genome for all imported datasets at once:</p>\",\n                \"<div>\",\n                'Type: <span id=\"library_extension_select\" class=\"library-extension-select\" />',\n                'Genome: <span id=\"library_genome_select\" class=\"library-genome-select\" />',\n                \"</div>\",\n                \"<div>\",\n                '<label class=\"checkbox-inline tag-files\">',\n                \"Tag datasets based on file names\",\n                '<input class=\"tag-files\" type=\"checkbox\" value=\"tag_using_filenames\">',\n                \"</label>\",\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateAddFilesFromHistory: function() {\n        return _.template(\n            [\n                '<div id=\"add_files_modal\">',\n                \"<div>\",\n                \"1.&nbsp;Select history:&nbsp;\",\n                '<select id=\"dataset_add_bulk\" name=\"dataset_add_bulk\" style=\"width:66%; \"> ',\n                \"<% _.each(histories, function(history) { %>\", //history select box\n                '<option value=\"<%= _.escape(history.get(\"id\")) %>\"><%= _.escape(history.get(\"name\")) %></option>',\n                \"<% }); %>\",\n                \"</select>\",\n                \"</div>\",\n                \"<br/>\",\n                '<div class=\"library_selected_history_content\">',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    },\n\n    templateHistoryContents: function() {\n        return _.template(\n            [\n                \"<p>2.&nbsp;Choose the datasets to import:</p>\",\n                \"<div>\",\n                '<button title=\"Select all datasets\" type=\"button\" class=\"button primary-button history-import-select-all\">',\n                \"Select all\",\n                \"</button>\",\n                '<button title=\"Select all datasets\" type=\"button\" class=\"button primary-button history-import-unselect-all\">',\n                \"Unselect all\",\n                \"</button>\",\n                \"</div>\",\n                \"<br>\",\n                \"<ul>\",\n                \"<% _.each(history_contents, function(history_item) { %>\",\n                '<% if (history_item.get(\"deleted\") != true ) { %>',\n                '<% var item_name = history_item.get(\"name\") %>',\n                '<% if (history_item.get(\"type\") === \"collection\") { %>',\n                '<% var collection_type = history_item.get(\"collection_type\") %>',\n                '<% if (collection_type === \"list\") { %>',\n                '<li data-id=\"<%= _.escape(history_item.get(\"id\")) %>\" data-name=\"<%= _.escape(history_item.get(\"type\")) %>\">',\n                \"<label>\",\n                '<label title=\"<%= _.escape(item_name) %>\">',\n                '<input style=\"margin: 0;\" type=\"checkbox\"> <%= _.escape(history_item.get(\"hid\")) %>: ',\n                '<%= item_name.length > 75 ? _.escape(\"...\".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection)',\n                \"</label>\",\n                \"</li>\",\n                \"<% } else { %>\",\n                '<li><input style=\"margin: 0;\" type=\"checkbox\" onclick=\"return false;\" disabled=\"disabled\">',\n                '<span title=\"You can convert this collection into a collection of type list using the Collection Tools\">',\n                '<%= _.escape(history_item.get(\"hid\")) %>: ',\n                '<%= item_name.length > 75 ? _.escape(\"...\".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection of type <%= _.escape(collection_type) %> not supported.)',\n                \"</span>\",\n                \"</li>\",\n                \"<% } %>\",\n                '<% } else if (history_item.get(\"visible\") === true && history_item.get(\"state\") === \"ok\") { %>',\n                '<li data-id=\"<%= _.escape(history_item.get(\"id\")) %>\" data-name=\"<%= _.escape(history_item.get(\"type\")) %>\">',\n                '<label title=\"<%= _.escape(item_name) %>\">',\n                '<input style=\"margin: 0;\" type=\"checkbox\"> <%= _.escape(history_item.get(\"hid\")) %>: ',\n                '<%= item_name.length > 75 ? _.escape(\"...\".concat(item_name.substr(-75))) : _.escape(item_name) %>',\n                \"</label>\",\n                \"</li>\",\n                \"<% } %>\",\n                \"<% } %>\",\n                \"<% }); %>\",\n                \"</ul>\"\n            ].join(\"\")\n        );\n    },\n\n    templatePaginator: function() {\n        return _.template(\n            [\n                '<ul class=\"pagination mr-1\">',\n                \"<% if ( ( show_page - 1 ) > 0 ) { %>\",\n                \"<% if ( ( show_page - 1 ) > page_count ) { %>\", // we are on higher page than total page count\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } else { %>\",\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                \"<% } else { %>\", // we are on the first page\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                \"<% } %>\",\n                '<li class=\"page-item active\">',\n                '<a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n                \"</li>\",\n                \"<% if ( ( show_page ) < page_count ) { %>\",\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li class=\"page-item\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } else { %>\",\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n                '<li class=\"page-item disabled\"><a class=\"page-link\" href=\"#folders/<%= id %>/page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                \"<% } %>\",\n                \"</ul>\",\n                '<span class=\"mr-1\">',\n                ' <%- items_shown %> items shown <a href=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"currently <%- folder_page_size %> per page\" class=\"page-size-prompt\">(change)</a>',\n                \"</span>\",\n                '<span class=\"mr-1\">',\n                \" <%- total_items_count %> total\",\n                \"</span>\"\n            ].join(\"\")\n        );\n    },\n\n    templateCollectionSelectModal: function() {\n        return _.template(\n            [\n                \"<div>\",\n                // elements selection\n                '<div class=\"library-modal-item\">',\n                \"<h4>Which datasets?</h4>\",\n                '<form class=\"form-inline\">',\n                '<label class=\"radio-inline\">',\n                '<input type=\"radio\" name=\"radio_elements\" id=\"selection_radio\" value=\"selection\" <% if (!selected_datasets) { %> disabled <% } else { %> checked <% } %> > current selection',\n                \"<% if (selected_datasets) { %>\",\n                \" (<%- selected_datasets %>)\",\n                \"<% } %>\",\n                \"</label>\",\n                '<label class=\"radio-inline\">',\n                '<input type=\"radio\" name=\"radio_elements\" id=\"folder_radio\" value=\"folder\" <% if (!selected_datasets) { %> checked <% } %> > all datasets in current folder',\n                \"</label>\",\n                \"</form>\",\n                \"</div>\",\n                // type selection\n                '<div class=\"library-modal-item\">',\n                \"<h4>Collection type</h4>\",\n                '<span class=\"library-collection-type-select\"/>',\n                \"<h5>Which type to choose?</h5>\",\n                \"<ul>\",\n                \"<li>\",\n                \"List: Generic collection which groups any number of datasets into a set; similar to file system folder.\",\n                \"</li>\",\n                \"<li>\",\n                \"Paired: Simple collection containing exactly two sequence datasets; one reverse and the other forward.\",\n                \"</li>\",\n                \"<li>\",\n                \"List of Pairs: Advanced collection containing any number of Pairs; imagine as Pair-type collections inside of a List-type collection.\",\n                \"</li>\",\n                \"<li>\",\n                \"From Rules: Use Galaxy's rule builder to describe collections. This is more of an advanced feature that allows building any number of collections or any type.\",\n                \"</li>\",\n                \"</ul>\",\n                \"</div>\",\n                // history selection/creation\n                '<div class=\"library-modal-item\">',\n                \"<h4>Select history</h4>\",\n                '<span class=\"library-collection-history-select\"/>',\n                \" or create new: \",\n                '<input type=\"text\" name=\"history_name\" value=\"\" placeholder=\"name of the new history\" />',\n                \"</div>\",\n                \"</div>\"\n            ].join(\"\")\n        );\n    }\n});\n\nexport default {\n    FolderToolbarView: FolderToolbarView\n};\n"]}