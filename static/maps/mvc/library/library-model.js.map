{"version":3,"sources":["mvc/library/library-model.js"],"names":["Library","Backbone","Model","extend","urlRoot","Galaxy","root","isVisible","show_deleted","get","Libraries","Collection","model","initialize","options","search","search_term","lowercase_term","toLowerCase","filter","lowercase_name","data","indexOf","getVisible","filters","filteredLibraries","item","sortLibraries","sort_key","sort_order","comparator","mod_util","generateLibraryComparator","sort","LibraryItem","Ldda","FolderAsModel","Folder","sortFolder","generateFolderComparator","FolderContainer","defaults","folder","id","parse","obj","reset","i","folder_contents","length","type","folder_item","add","file_item","emit","error","HistoryItem","HistoryContents","url","GalaxyHistory","GalaxyHistories","Jstree","Item"],"mappings":"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","file":"../../../scripts/mvc/library/library-model.js","sourcesContent":["import mod_util from \"mvc/library/library-util\";\n// ============================================================================\n// LIBRARY RELATED MODELS\n\nvar Library = Backbone.Model.extend({\n    urlRoot: `${Galaxy.root}api/libraries/`,\n\n    /** based on show_deleted would this lib show in the list of lib's?\n     *  @param {Boolean} show_deleted are we including deleted libraries?\n     */\n    isVisible: function(show_deleted) {\n        var isVisible = true;\n        if (!show_deleted && this.get(\"deleted\")) {\n            isVisible = false;\n        }\n        return isVisible;\n    }\n});\n\nvar Libraries = Backbone.Collection.extend({\n    urlRoot: `${Galaxy.root}api/libraries`,\n\n    model: Library,\n\n    initialize: function(options) {\n        options = options || {};\n    },\n\n    search: function(search_term) {\n        /**\n         * Search the collection and return only the models that have\n         * the search term in their names.\n         * [the term to search]\n         * @type {string}\n         */\n        if (search_term == \"\") return this;\n        var lowercase_term = search_term.toLowerCase();\n        return this.filter(data => {\n            var lowercase_name = data.get(\"name\").toLowerCase();\n            return lowercase_name.indexOf(lowercase_term) !== -1;\n        });\n    },\n\n    /** Get every 'shown' library in this collection based on deleted filter\n     *  @param {Boolean} show_deleted are we including deleted libraries?\n     *  @returns array of library models\n     */\n    getVisible: function(show_deleted, filters) {\n        filters = filters || [];\n        var filteredLibraries = new Libraries(this.filter(item => item.isVisible(show_deleted)));\n\n        return filteredLibraries;\n    },\n\n    sortLibraries: function(sort_key, sort_order) {\n        this.comparator = mod_util.generateLibraryComparator(sort_key, sort_order);\n        this.sort();\n    }\n});\n\n// ============================================================================\n// FOLDER RELATED MODELS\n\nvar LibraryItem = Backbone.Model.extend({});\n\nvar Ldda = LibraryItem.extend({\n    urlRoot: `${Galaxy.root}api/libraries/datasets/`\n});\n\nvar FolderAsModel = LibraryItem.extend({\n    urlRoot: `${Galaxy.root}api/folders/`\n});\n\nvar Folder = Backbone.Collection.extend({\n    model: LibraryItem,\n\n    sortFolder: function(sort_key, sort_order) {\n        this.comparator = mod_util.generateFolderComparator(sort_key, sort_order);\n        this.sort();\n    }\n});\n\nvar FolderContainer = Backbone.Model.extend({\n    defaults: {\n        folder: new Folder(),\n        urlRoot: `${Galaxy.root}api/folders/`,\n        id: \"unknown\"\n    },\n    parse: function(obj) {\n        // empty the collection\n        this.get(\"folder\").reset();\n        // response is not a simple array, it contains metadata\n        // this will update the inner collection\n        for (var i = 0; i < obj.folder_contents.length; i++) {\n            if (obj.folder_contents[i].type === \"folder\") {\n                var folder_item = new FolderAsModel(obj.folder_contents[i]);\n                this.get(\"folder\").add(folder_item);\n            } else if (obj.folder_contents[i].type === \"file\") {\n                var file_item = new Ldda(obj.folder_contents[i]);\n                this.get(\"folder\").add(file_item);\n            } else {\n                Galaxy.emit.error(\"Unknown folder item type encountered while parsing response.\");\n            }\n        }\n        return obj;\n    }\n});\n\n// ============================================================================\n// HISTORY RELATED MODELS\n// TODO UNITE\n\nvar HistoryItem = Backbone.Model.extend({\n    urlRoot: `${Galaxy.root}api/histories/`\n});\n\nvar HistoryContents = Backbone.Collection.extend({\n    urlRoot: `${Galaxy.root}api/histories/`,\n    initialize: function(options) {\n        this.id = options.id;\n    },\n    url: function() {\n        return `${this.urlRoot + this.id}/contents`;\n    },\n    model: HistoryItem\n});\n\nvar GalaxyHistory = Backbone.Model.extend({\n    urlRoot: `${Galaxy.root}api/histories/`\n});\n\nvar GalaxyHistories = Backbone.Collection.extend({\n    url: `${Galaxy.root}api/histories`,\n    model: GalaxyHistory\n});\n\n// ============================================================================\n// JSTREE MODEL\n/** Represents folder structure parsable by the jstree component.\n *\n */\n\nvar Jstree = Backbone.Model.extend({\n    urlRoot: `${Galaxy.root}api/remote_files`\n});\n\nexport default {\n    Library: Library,\n    Libraries: Libraries,\n    Item: Ldda,\n    Ldda: Ldda,\n    FolderAsModel: FolderAsModel,\n    Folder: Folder,\n    FolderContainer: FolderContainer,\n    HistoryItem: HistoryItem,\n    HistoryContents: HistoryContents,\n    GalaxyHistory: GalaxyHistory,\n    GalaxyHistories: GalaxyHistories,\n    Jstree: Jstree\n};\n"]}