{"version":3,"sources":["mvc/form/form-repeat.js"],"names":["View","Backbone","extend","initialize","options","list","Utils","merge","title","empty_text","max","min","button_new","Ui","ButtonIcon","icon","tooltip","cls","onclick","onnew","setElement","$","append","$list","$el","size","_","add","id","Galaxy","emit","debug","button_delete","ondel","portlet","Portlet","operations","addClass","hide","fadeIn","disable","_refresh","del","find","remove","enable","delAll","hideOptions","each","hideOperation","isEmpty","html","index"],"mappings":"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","file":"../../../scripts/mvc/form/form-repeat.js","sourcesContent":["import _l from \"utils/localization\";\n/** This class creates a ui component which enables the dynamic creation of portlets */\nimport Utils from \"utils/utils\";\nimport Portlet from \"mvc/ui/ui-portlet\";\nimport Ui from \"mvc/ui/ui-misc\";\n\nexport var View = Backbone.View.extend({\n    initialize: function(options) {\n        this.list = {};\n        this.options = Utils.merge(options, {\n            title: _l(\"Repeat\"),\n            empty_text: \"Not available.\",\n            max: null,\n            min: null\n        });\n        this.button_new = new Ui.ButtonIcon({\n            icon: \"fa-plus\",\n            title: `Insert ${this.options.title}`,\n            tooltip: `Add new ${this.options.title} block`,\n            cls: \"ui-button-icon ui-clear-float form-repeat-add\",\n            onclick: function() {\n                if (options.onnew) {\n                    options.onnew();\n                }\n            }\n        });\n        this.setElement(\n            $(\"<div/>\")\n                .append((this.$list = $(\"<div/>\")))\n                .append($(\"<div/>\").append(this.button_new.$el))\n        );\n    },\n\n    /** Number of repeat blocks */\n    size: function() {\n        return _.size(this.list);\n    },\n\n    /** Add new repeat block */\n    add: function(options) {\n        if (!options.id || this.list[options.id]) {\n            Galaxy.emit.debug(\"form-repeat::add()\", \"Duplicate or invalid repeat block id.\");\n            return;\n        }\n        var button_delete = new Ui.ButtonIcon({\n            icon: \"fa-trash-o\",\n            tooltip: _l(\"Delete this repeat block\"),\n            cls: \"ui-button-icon-plain form-repeat-delete\",\n            onclick: function() {\n                if (options.ondel) {\n                    options.ondel();\n                }\n            }\n        });\n        var portlet = new Portlet.View({\n            id: options.id,\n            title: _l(\"placeholder\"),\n            cls: options.cls || \"ui-portlet-repeat\",\n            operations: { button_delete: button_delete }\n        });\n        portlet.append(options.$el);\n        portlet.$el.addClass(\"section-row\").hide();\n        this.list[options.id] = portlet;\n        this.$list.append(portlet.$el.fadeIn(\"fast\"));\n        if (this.options.max > 0 && this.size() >= this.options.max) {\n            this.button_new.disable();\n        }\n        this._refresh();\n    },\n\n    /** Delete repeat block */\n    del: function(id) {\n        if (!this.list[id]) {\n            Galaxy.emit.debug(\"form-repeat::del()\", \"Invalid repeat block id.\");\n            return;\n        }\n        this.$list.find(`#${id}`).remove();\n        delete this.list[id];\n        this.button_new.enable();\n        this._refresh();\n    },\n\n    /** Remove all */\n    delAll: function() {\n        for (var id in this.list) {\n            this.del(id);\n        }\n    },\n\n    /** Hides add/del options */\n    hideOptions: function() {\n        this.button_new.$el.hide();\n        _.each(this.list, portlet => {\n            portlet.hideOperation(\"button_delete\");\n        });\n        if (_.isEmpty(this.list)) {\n            this.$el.append(\n                $(\"<div/>\")\n                    .addClass(\"ui-form-info\")\n                    .html(this.options.empty_text)\n            );\n        }\n    },\n\n    /** Refresh view */\n    _refresh: function() {\n        var index = 0;\n        for (var id in this.list) {\n            var portlet = this.list[id];\n            portlet.title(`${++index}: ${this.options.title}`);\n            portlet[this.size() > this.options.min ? \"showOperation\" : \"hideOperation\"](\"button_delete\");\n        }\n    }\n});\n\nexport default {\n    View: View\n};\n"]}